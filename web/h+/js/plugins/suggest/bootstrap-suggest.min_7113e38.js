!function(t){t.fn.bsSuggest=function(t){return"string"==typeof t&&e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void 0:e.init.apply(this,arguments)};var e={init:function(e){function i(e,i,n){return i.is(":visible")?void setTimeout(function(){n.autoDropup&&t(window).height()-e.offset().top<i.height()&&e.offset().top>i.height()+t(window).scrollTop()?i.parents(".input-group").addClass("dropup"):i.parents(".input-group.dropup").removeClass("dropup")},100):("left"===n.listAlign?i.css({left:e.siblings("div").width()-e.parent().width(),right:"auto"}):"right"===n.listAlign&&i.css({left:"auto",right:"0"}),n.autoMinWidth===!1?i.css({"min-width":e.parent().width()}):i.css("width","auto"),e)}function n(t,e){var i,n,o;return-1===e.indexId&&!e.idField||e.multiWord?t:(i=t.css("background-color").replace(/ /g,"").split(",",3).join(","),n=e.inputBgColor||"rgba(255,255,255,0.1)",o=e.inputWarnColor||"rgba(255,255,0,0.1)",!t.val()||t.attr("data-id")?t.css("background",n):(-1===o.indexOf(i)&&(t.trigger("onUnsetSelectValue"),t.css("background",o)),t))}function o(t,e){var i,n,o=t.parent().find("tbody tr."+b.listHoverCSS);o.length>0&&(i=(o.index()+3)*o.height(),n=Number(e.css("max-height").replace("px","")),e.scrollTop(i>n||e.scrollTop()>n?i-n:0))}function a(t,e){t=t||$dropdownMenu,e=e||b,t.find("tr."+e.listHoverCSS).removeClass(e.listHoverCSS)}function r(e){var i=t(e),n=i.parent(".input-group").find("ul.dropdown-menu"),o=i.data("bsSuggest");return 0===n.length?!1:o?!1:(i.data("bsSuggest",{target:e,options:b}),!0)}function s(e,i,n,o){var a,r,s,l,f,c,h,g={value:[]};if(e=e||"",o=o||b,o.url)f=-1!==o.url.indexOf("?")?"&":"?",c=o.jsonp?[o.url+e,f,o.jsonp,"=?"].join(""):o.url+e,t.ajax({type:"GET",url:c,dataType:"json",timeout:3e3}).done(function(t){n(i,t,o),i.trigger("onDataRequestSuccess",t),"firstByUrl"===b.getDataMethod&&(b.data=t,b.url=null)}).fail(v);else{if(a=o.data,r=d(a))if(e){for(h=a.value.length,s=0;h>s;s++)for(l in a.value[s])if(t.trim(a.value[s][l])&&(p(l,o)||u(l,o))&&(-1!==a.value[s][l].toString().indexOf(e)||-1!==e.indexOf(a.value[s][l]))){g.value.push(a.value[s]);break}}else g=a;n(i,g,o)}}function l(t){return validData=d(t)}function d(t){var e=!0;for(var i in t)if("value"===i){e=!1;break}return e?(v("返回数据格式错误!"),!1):0===t.value.length?!1:t}function u(e,i){return i=i||b,t.isArray(i.effectiveFields)&&i.effectiveFields.length>0&&-1===t.inArray(e,i.effectiveFields)?!1:!0}function p(e,i){return-1!==t.inArray(e,i.searchFields)?!0:!1}function f(t,e,n){var o,a,r,s,d,p,f,h=t.parent().find("ul.dropdown-menu"),g=0,v=['<table class="table table-condensed">'];if(n=n||b,e=l(e),e===!1||0===(o=e.value.length))return h.empty().hide(),t;if(n.showHeader){s="<thead><tr>";for(r in e.value[0])u(r)!==!1&&(s+=0===g?"<th>"+(n.effectiveFieldsAlias[r]||r)+"("+o+")</th>":"<th>"+(n.effectiveFieldsAlias[r]||r)+"</th>",g++);s+="</tr></thead>",v.push(s)}for(v.push("<tbody>"),a=0;o>a;a++){g=0,d="",p=e.value[a][n.idField]||"",f=e.value[a][n.keyField]||"";for(r in e.value[a])f||n.indexKey!==g||(f=e.value[a][r]),p||n.indexId!==g||(p=e.value[a][r]),g++,u(r)!==!1&&(d+='<td data-name="'+r+'">'+e.value[a][r]+"</td>");d='<tr data-index="'+a+'" data-id="'+p+'" data-key="'+f+'">'+d+"</tr>",v.push(d)}return v.push("</tbody></table>"),h.html(v.join("")).show(),c(t,h,n),h.css("max-height")&&Number(h.css("max-height").replace("px",""))<Number(h.find("table:eq(0)").css("height").replace("px",""))&&Number(h.css("min-width").replace("px",""))<Number(h.css("width").replace("px",""))?h.css("padding-right","20px").find("table:eq(0)").css("margin-bottom","20px"):h.css("padding-right",0).find("table:eq(0)").css("margin-bottom",0),i(t,h,n),t}function c(e,i,o){i=i||$dropdownMenu,o=o||b,i.find("tbody tr").each(function(){t(this).off("mouseenter").on("mouseenter",function(){a(i,o),t(this).addClass(o.listHoverCSS)}).off("mousedown").on("mousedown",function(){g(e,h(t(this)),o),n(e,o)})})}function h(t){var e={};return e.id=t.attr("data-id"),e.key=t.attr("data-key"),e}function g(t,e,i){var n,o=e||{},a=o.id||"",r=o.key||"";i&&i.multiWord?(n=t.val().split(i.separator||" "),n[n.length-1]=r,t.val(n.join(i.separator||" ")).focus()):t.attr("data-id",a).focus().val(r),t.trigger("onSetSelectValue",o)}function v(t,e){console.trace(t),e&&console.trace(e)}var y=this,b=t.extend({url:null,jsonp:null,data:{},getDataMethod:"firstByUrl",delayUntilKeyup:!1,indexId:0,indexKey:0,idField:"",keyField:"",effectiveFields:[],effectiveFieldsAlias:{},searchFields:[],showHeader:!1,showBtn:!0,allowNoKeyword:!0,multiWord:!1,separator:",",processData:l,getData:s,autoMinWidth:!1,autoDropup:!1,listAlign:"left",inputBgColor:"",inputWarnColor:"rgba(255,0,0,.1)",listStyle:{"padding-top":0,"max-height":"375px","max-width":"800px",overflow:"auto",width:"auto",transition:"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"},listHoverStyle:"background: #07d; color:#fff",listHoverCSS:"jhover",keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13},e);if(t.isFunction(b.processData)&&(l=b.processData),t.isFunction(b.getData)&&(s=b.getData),!e.showHeader&&b.effectiveFields&&b.effectiveFields.length>1&&(b.showHeader=!0),"firstByUrl"===b.getDataMethod&&b.url&&!b.delayUntilKeyup){var m=-1!==e.url.indexOf("?")?"&":"?",w=e.jsonp?[e.url,m,e.jsonp,"=?"].join(""):e.url;t.ajax({type:"GET",url:w,dataType:"json",timeout:5e3}).done(function(e){b.data=e,b.url=null,t(y).trigger("onDataRequestSuccess",e)}).fail(function(t,e){console.error(w+" : "+e)})}return t("head:eq(0)").append("<style>."+b.listHoverCSS+"{"+b.listHoverStyle+"}</style>"),y.each(function(){var l=t(this),d=l.parents(".input-group:eq(0)").find("ul.dropdown-menu");return r(this)===!1?void console.warn("不是一个标准的 bootstrap 下拉式菜单:",this):(b.showBtn||l.css("border-radius","4px").parents(".input-group:eq(0)").css("width","100%").find(".input-group-btn>.btn").hide(),l.removeClass("disabled").attr("disabled",!1).attr("autocomplete","off"),d.css(b.listStyle),b.inputBgColor||(b.inputBgColor=l.css("background-color")),l.on("keydown",function(e){var i,n="";"none"!==d.css("display")&&(i=d.find("."+b.listHoverCSS),n="",e.keyCode===b.keyDown?(0===i.length?n=h(d.find("table tbody tr:first").mouseover()):0===i.next().length?(a(d,b),t(this).val(t(this).attr("alt")).attr("data-id","")):(a(d,b),0!==i.next().length&&(n=h(i.next().mouseover()))),o(l,d)):e.keyCode===b.keyUp?(0===i.length?n=h(d.find("table tbody tr:last").mouseover()):0===i.prev().length?(a(d,b),t(this).val(t(this).attr("alt")).attr("data-id","")):(a(d,b),0!==i.prev().length&&(n=h(i.prev().mouseover()))),o(l,d)):e.keyCode===b.keyEnter?d.hide().empty():t(this).attr("data-id",""),n&&""!==n.key&&g(t(this),n,b))}).on("keyup",function(i){var o,a;return i.keyCode===b.keyDown||i.keyCode===b.keyUp||i.keyCode===b.keyEnter?(t(this).val(t(this).val()),void n(l,b)):(t(this).attr("data-id",""),n(l,b),o=t(this).val(),void((""===t.trim(o)||o!==t(this).attr("alt"))&&(t(this).attr("alt",t(this).val()),e.multiWord&&(a=o.split(b.separator||" "),o=a[a.length-1]),(0!==o.length||b.allowNoKeyword)&&s(t.trim(o),l,f,b))))}).on("focus",function(){i(l,d,b)}).on("blur",function(){d.css("display","")}).on("click",function(){var e,i=t(this).val();return""!==t.trim(i)&&i===t(this).attr("alt")&&d.find("table tr").length?d.show():void("none"===d.css("display")&&(b.multiWord&&(e=i.split(b.separator||" "),i=e[e.length-1]),(0!==i.length||b.allowNoKeyword)&&s(t.trim(i),l,f,b)))}),l.parent().find("button:eq(0)").attr("data-toggle","").on("click",function(){var t;"none"===d.css("display")?(t="block",b.url?l.click().focus():(f(l,b.data,b),i(l,d,b))):t="none",d.css("display",t)}),void d.on("mouseenter",function(){t(this).show()}).on("mouseleave",function(){l.focus()}))})},show:function(){var t=this.data("bsSuggest");return t&&t.options&&this.parent().find("ul.dropdown-menu").show(),this},hide:function(){var t=this.data("bsSuggest");return t&&t.options&&this.parent().find("ul.dropdown-menu").css("display",""),this},disable:function(){return t(this).data("bsSuggest")?void t(this).attr("disabled",!0).parent().find(".input-group-btn>.btn").addClass("disabled"):!1},enable:function(){return t(this).data("bsSuggest")?void t(this).attr("disabled",!1).parent().find(".input-group-btn>.btn").removeClass("disabled"):!1},destroy:function(){t(this).off().removeData("bsSuggest").parent().find(".input-group-btn>.btn").off()},version:function(){return"0.0.1"}}}(window.jQuery);